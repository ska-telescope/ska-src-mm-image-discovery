#!/usr/bin/env python

import argparse
import json

from ska_src_mm_image_discovery_api.client.mm_image_discovery import MmImageDiscoveryClient


if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('--api-url', help="mm-image-discovery api url", type=str,
                        default="https://mm-image-discovery.srcdev.skao.int/api/v1")
    subparsers = parser.add_subparsers(help='command line interface for the mm-image-discovery api', dest='command')

    # health
    health_parser = subparsers.add_parser("health")

    # ping
    ping_parser = subparsers.add_parser("ping")

    args = parser.parse_args()

    client = MmImageDiscoveryClient(args.api_url)
    if args.command == 'health':
        rtn = client.health()
        rtn.raise_for_status()
    elif args.command == 'ping':
        rtn = client.ping()
        rtn.raise_for_status()
    else:
        print(parser.print_help())
        exit()
    print(json.dumps(rtn.json(), indent=2))
